<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Entities and Components - Understanding Bevy</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../ecs/_index.html"><strong aria-hidden="true">2.</strong> Entities, Components and Systems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ecs/entities-components.html" class="active"><strong aria-hidden="true">2.1.</strong> Entities and Components</a></li><li class="chapter-item expanded "><a href="../ecs/systems-queries.html"><strong aria-hidden="true">2.2.</strong> Systems and Queries</a></li><li class="chapter-item expanded "><a href="../ecs/resources.html"><strong aria-hidden="true">2.3.</strong> Resources</a></li><li class="chapter-item expanded "><a href="../ecs/timing/_index.html"><strong aria-hidden="true">2.4.</strong> Control Flow and Timing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ecs/timing/scheduling-stages.html"><strong aria-hidden="true">2.4.1.</strong> System Scheduling and Stages</a></li><li class="chapter-item expanded "><a href="../ecs/communication/conditional-systems.html"><strong aria-hidden="true">2.4.2.</strong> Run Criteria and States</a></li><li class="chapter-item expanded "><a href="../ecs/timing/timers.html"><strong aria-hidden="true">2.4.3.</strong> Timers and Time Steps</a></li></ol></li><li class="chapter-item expanded "><a href="../ecs/communication/_index.html"><strong aria-hidden="true">2.5.</strong> Tools for Intersystem Communication</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ecs/communication/commands.html"><strong aria-hidden="true">2.5.1.</strong> Commands</a></li><li class="chapter-item expanded "><a href="../ecs/communication/events.html"><strong aria-hidden="true">2.5.2.</strong> Events</a></li><li class="chapter-item expanded "><a href="../ecs/communication/chaining.html"><strong aria-hidden="true">2.5.3.</strong> Chaining Systems</a></li></ol></li><li class="chapter-item expanded "><a href="../ecs/internals/_index.html"><strong aria-hidden="true">2.6.</strong> ECS Internals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ecs/internals/app-builder.html"><strong aria-hidden="true">2.6.1.</strong> App Builder</a></li><li class="chapter-item expanded "><a href="../ecs/internals/world.html"><strong aria-hidden="true">2.6.2.</strong> World</a></li><li class="chapter-item expanded "><a href="../ecs/internals/default-plugins.html"><strong aria-hidden="true">2.6.3.</strong> Default Plugins</a></li><li class="chapter-item expanded "><a href="../ecs/internals/archetypes.html"><strong aria-hidden="true">2.6.4.</strong> Archetypes</a></li><li class="chapter-item expanded "><a href="../ecs/internals/reflection.html"><strong aria-hidden="true">2.6.5.</strong> Reflection</a></li></ol></li><li class="chapter-item expanded "><a href="../ecs/think-ecs.html"><strong aria-hidden="true">2.7.</strong> Think ECS: Idiomatic Problem Solving in Bevy</a></li></ol></li><li class="chapter-item expanded "><a href="../organization/_index.html"><strong aria-hidden="true">3.</strong> Organizing Your Bevy Codebase</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../organization/project-structure.html"><strong aria-hidden="true">3.1.</strong> Project Structure</a></li><li class="chapter-item expanded "><a href="../organization/plugins.html"><strong aria-hidden="true">3.2.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="../organization/scenes.html"><strong aria-hidden="true">3.3.</strong> Scenes</a></li></ol></li><li class="chapter-item expanded "><a href="../serialization/_index.html"><strong aria-hidden="true">4.</strong> Serialization and Networking</a></li><li class="chapter-item expanded "><a href="../graphics/_index.html"><strong aria-hidden="true">5.</strong> Graphics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../graphics/assets-sprites.html"><strong aria-hidden="true">5.1.</strong> Assets and Sprites</a></li><li class="chapter-item expanded "><a href="../graphics/transforms.html"><strong aria-hidden="true">5.2.</strong> Transforms</a></li><li class="chapter-item expanded "><a href="../graphics/cameras.html"><strong aria-hidden="true">5.3.</strong> Cameras</a></li><li class="chapter-item expanded "><a href="../graphics/children.html"><strong aria-hidden="true">5.4.</strong> Hierarchy: Parents and Children</a></li><li class="chapter-item expanded "><a href="../graphics/animation.html"><strong aria-hidden="true">5.5.</strong> Animation</a></li><li class="chapter-item expanded "><a href="../graphics/meshes.html"><strong aria-hidden="true">5.6.</strong> Meshes</a></li><li class="chapter-item expanded "><a href="../graphics/shaders.html"><strong aria-hidden="true">5.7.</strong> Shaders</a></li><li class="chapter-item expanded "><a href="../graphics/vector_graphics.html"><strong aria-hidden="true">5.8.</strong> Vector Graphics</a></li></ol></li><li class="chapter-item expanded "><a href="../ui/_index.html"><strong aria-hidden="true">6.</strong> User Interfaces</a></li><li class="chapter-item expanded "><a href="../audio/_index.html"><strong aria-hidden="true">7.</strong> Audio</a></li><li class="chapter-item expanded "><a href="../input/_index.html"><strong aria-hidden="true">8.</strong> Input</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../input/keyboard.html"><strong aria-hidden="true">8.1.</strong> Keyboard</a></li><li class="chapter-item expanded "><a href="../input/mouse.html"><strong aria-hidden="true">8.2.</strong> Mouse</a></li><li class="chapter-item expanded "><a href="../input/controller.html"><strong aria-hidden="true">8.3.</strong> Controller</a></li><li class="chapter-item expanded "><a href="../input/touch.html"><strong aria-hidden="true">8.4.</strong> Touch</a></li></ol></li><li class="chapter-item expanded "><a href="../physics/_index.html"><strong aria-hidden="true">9.</strong> Physics</a></li><li class="chapter-item expanded "><a href="../development/_index.html"><strong aria-hidden="true">10.</strong> Productive Development in Bevy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../development/compiling.html"><strong aria-hidden="true">10.1.</strong> Compiling your Game</a></li><li class="chapter-item expanded "><a href="../development/testing.html"><strong aria-hidden="true">10.2.</strong> Idiomatic Automated Testing</a></li><li class="chapter-item expanded "><a href="../development/diagnostics.html"><strong aria-hidden="true">10.3.</strong> Diagnostics and Debugging</a></li><li class="chapter-item expanded "><a href="../development/cross-platform.html"><strong aria-hidden="true">10.4.</strong> Cross-Platform Support</a></li><li class="chapter-item expanded "><a href="../development/releasing.html"><strong aria-hidden="true">10.5.</strong> Releasing your Game</a></li><li class="chapter-item expanded "><a href="../development/common-issues.html"><strong aria-hidden="true">10.6.</strong> Common Issues and Finding Help</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Understanding Bevy</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#entities-and-components" id="entities-and-components">Entities and Components</a></h1>
<p>The ECS architecture, at its heart, is about efficiently laying out data, and then accessing it in principled ways.
Drawing on the metaphors of databases, we can think of each <strong>component</strong> as representing a unique column of data, with a homogenous type, and each row determines which entity that component belongs to.</p>
<p>Every entity in Bevy has a special component called <code>Entity</code>, which serves as our primary key into the database, allowing us to fetch the appropriate component efficiently. In <a href="internals/archetypes.html">archetypal</a> ECS, like Bevy, we can extend this metaphor further. An archetype is a collection of entities with a specific set of components: creating an efficient sub-table where every cell, regardless of its entity or component, has a valid entry.</p>
<p>When we want to read or modify the data stored in our components, we can use a <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/struct.Query.html"><code>Query</code></a>: allowing us to extract the columns we care about. We can further filter within this <code>Query</code> by using a <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/trait.QueryFilter.html"><code>QueryFilter</code></a>, allowing us to limit ourselves to only entities that have or lack a certain component, or have recently changed.</p>
<h2><a class="header" href="#designing-components" id="designing-components">Designing Components</a></h2>
<p>In Bevy, you can make nearly anything a component: merely give it a unique type (see <a href="resources.html#ensuring-unique-resource-types"><em>Ensuring Unique Resource Types</em></a> for tips) add it your entities, and then query away. 
The only caveat is that it must fulfill the <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/trait.Component.html"><code>Component</code></a> trait: it must be <code>Send + Sync + 'static</code>, allowing us to safely pass components between threads.</p>
<p>As your codebase grows, you're going to want to <code>impl Default</code> (or create a <code>new</code> method) for most of your component types or component bundles. 
This helps ensure consistent behavior (rather than having to track down 17 different constants) and can make spawning new entities less onerous.</p>
<p>Because Bevy's <a href="timing/scheduling.html">scheduler</a> allows us to automatically parallelize systems that don't have conflicting read/write demands on our components or systems, it's good practice to make your components small. 
You should continue to break down your components until you're reasonably sure that hypothetical future systems will never want to consume one of its fields without the context of at least one other piece. 
Even if they're commonly used together, you should consider using a component bundle of small components, rather than one large component.</p>
<p>This practice also makes it much easier to extend your systems to support new, possibly unplanned behavior. 
From a design perspective, components in ECS fill a very similar role to Rust's traits. 
Rather than needing to think about precisely which [types / archetypes] our [functions / systems] are running on, [traits / components] guarantee the presence of certain data, and the desirability of certain behavior.</p>
<p>This allows us to skip verifying that the entity that we're operating on has certain properties; instead constructing more expressive type signatures for your queries (corresponding to more exact trait bounds). 
This is harder to accidentally break, easier to read, and should permit more of your systems to run in parallel as you only request the exact data you'll be operating on.</p>
<h3><a class="header" href="#marker-components" id="marker-components">Marker Components</a></h3>
<p>When translating a game design to an ECS paradigm, you'll often want to be able to easily toggle behavior for different entities based on one of their properties.
The idiomatic way to do so is to create a <strong>marker component</strong>: a data-less <a href="https://doc.rust-lang.org/rust-by-example/custom_types/structs.html">unit struct</a> that can be used to filter the entities returned by your queries using <code>With</code> or <code>Without</code> (see below). Here's some guidance on when you might want to use them:</p>
<ul>
<li>Marker components are great for controlling whether a behavior (or set of behaviors) occurs at all. for things like enabling collisions or handling buffs.</li>
<li>If you always want to perform a behavior, but with some variants, control it using data stored in your component (as a field or as an enum), rather than proliferating marker components.</li>
<li>Adding and removing components has a substantial performance cost in archetype-based ECS like Bevy. If your game is performance-limited, marker components may be the wrong tool for handling things like short-lived buffs.</li>
</ul>
<h3><a class="header" href="#option-components" id="option-components">Option Components</a></h3>
<p>Sometimes, you don't know the value of a component at the time of its creation (or it may sometimes cease to exist during the course of gameplay). 
This might commonly be observed for components that relate one entity to another by storing an <code>Entity</code> as part of their data: defining a parent-child relationship, designating a target or so on. 
A useful pattern here is to wrap your component type <code>T</code> in an <code>Option&lt;T&gt;</code>, allowing you to safely set its value to <code>None</code>.
This ensuring that it shows up in the appropriate queries, its archetype is stable (helping performance) and you can take advantage of Rust's enum matching tools to ensure that you're always handling the possibility of missing data appropriately.</p>
<h3><a class="header" href="#component-bundles" id="component-bundles">Component Bundles</a></h3>
<p>In certain complex subsystems of our game, we may want large quantities of related data to be created and consumed at the same time.
Bevy offers <strong>component bundles</strong> for this purpose, allowing us to stick to small, modular components while providing some nice sugar to ensure that components aren't carelessly forgotten.</p>
<p>Bevy itself uses this pattern for <a href="../graphics/assets-sprites.html">Sprites</a>, <a href="../ui/_index.html">UI</a>, <a href="../graphics/cameras.html">Cameras</a> and so on. Here's a quick demo of how you might work with bundles (both <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/trait.Bundle.html">static</a> and <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/trait.DynamicBundle.html">dynamic</a>):</p>
<p><code>rust </code></p>
<h2><a class="header" href="#spawning-and-despawning-entities" id="spawning-and-despawning-entities">Spawning and Despawning Entities</a></h2>
<p>In order for your nicely-architected components to do much of anything, you're going to want to create some entities with those components.
Pass in a tuple of components or a component bundle to <code>commands.spawn</code> and you'll get a new entity with those components:</p>
<p><code>rust </code></p>
<p>Despawning entities is easy, so long as you know which entity to grab:</p>
<p><code>rust </code></p>
<p>Because entity creation and deletion are wide-reaching operations that involve altering archetypes, they can only be done via <a href="communication/commands.html"><code>Commands</code></a> or in a thread-local system by modifying <a href="">World</a>. 
As a result, they will not take effect until the end of the current <a href="timing/stages.html">stage</a>.</p>
<p>When you're creating many of the same archetype of entity at once, it's somewhat more efficient to <a href="https://docs.rs/bevy/0.4.0/bevy/ecs/struct.Commands.html#method.spawn_batch">spawn them in a batch</a>, allowing Bevy to allocate memory a single time. To do so, you need to create an appropriate iterator:</p>
<p><code>rust</code></p>
<h2><a class="header" href="#modifying-components-after-creation" id="modifying-components-after-creation">Modifying Components After Creation</a></h2>
<p>While changing the archetype of an entity has a performance cost, it can often be the clearest way to handle a change in an entity's behavior.
You can add and remove components to entities with <code>insert</code>, <code>remove</code>, <code>insert_one</code> and <code>remove_one</code> (<a href="https://docs.rs/bevy/0.4.0/bevy/ecs/struct.Commands.html#method.insert">see the methods on <code>Commands</code></a>):</p>
<p><code>rust</code></p>
<p>Like entity creation and deletion, modifying components can only be done via <code>Commands</code> or in a thread-local system and will not take effect until the end of the current stage.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../ecs/_index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../ecs/systems-queries.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../ecs/_index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../ecs/systems-queries.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
